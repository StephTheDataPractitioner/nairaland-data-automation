expression 'Sample File' = ```
		let
		    // Connect directly to the container (Source is the container table)
		    Source = AzureStorage.DataLake("https://lstor.dfs.core.windows.net/naircont"),
		
		    // Source already returns a table of items (files & folders)
		    Container = Source,  
		
		    // recursion function same as Option A
		    GetAllFiles = (tbl as table) =>
		        let
		            FilesHere = Table.SelectRows(tbl, each Record.FieldOrDefault(_, "IsFolder", false) = false),
		            FoldersHere = Table.SelectRows(tbl, each Record.FieldOrDefault(_, "IsFolder", false) = true),
		            ChildFiles =
		                if Table.IsEmpty(FoldersHere) then
		                    #table(Table.ColumnNames(FilesHere), {})
		                else
		                    Table.Combine(List.Transform(FoldersHere[Data], each GetAllFiles(_))),
		            AllFiles = if Table.IsEmpty(FilesHere) then ChildFiles else
		                       if Table.IsEmpty(ChildFiles) then FilesHere else Table.Combine({FilesHere, ChildFiles})
		        in
		            AllFiles,
		
		    AllFiles = GetAllFiles(Container),
		
		    JSONFiles = Table.SelectRows(AllFiles, each Text.EndsWith(Text.Lower(Record.FieldOrDefault(_, "Name", "")), ".json")),
		
		    AddContent = Table.AddColumn(JSONFiles, "JSONContent", each try Json.Document([Content]) otherwise null),
		
		    AllFieldNames =
		        List.RemoveNulls(
		            List.Distinct(
		                List.Combine(
		                    List.Transform(
		                        List.RemoveNulls(AddContent[JSONContent]),
		                        each if Value.Is(_, type record) then Record.FieldNames(_) else {}
		                    )
		                )
		            )
		        ),
		
		    Expanded =
		        if List.IsEmpty(AllFieldNames) then
		            AddContent
		        else
		            Table.ExpandRecordColumn(AddContent, "JSONContent", AllFieldNames, AllFieldNames),
		
		    KeepCols = Table.SelectColumns(Expanded, List.Intersect({Table.ColumnNames(Expanded), {"Name","FolderPath","Content"}}) & AllFieldNames),
		    Navigation1 = KeepCols{0}[Content]
		in
		    Navigation1
		```
	lineageTag: 602d4713-987f-4b6f-9f2b-8b5235c027de
	queryGroup: 'Transform File from Query6\Helper Queries'

	annotation PBI_ResultType = Binary

expression Parameter1 = #"Sample File" meta [IsParameterQuery=true, BinaryIdentifier=#"Sample File", Type="Binary", IsParameterQueryRequired=true]
	lineageTag: a48dfe26-3917-4420-b20d-ce835c0b1b30
	queryGroup: 'Transform File from Query6\Helper Queries'

	annotation PBI_ResultType = Binary

	annotation PBI_NavigationStepName = Navigation

expression 'Transform Sample File' =
		let
		    Source = Json.Document(Parameter1),
		    #"Converted to Table" = Table.FromList(Source, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
		    #"Expanded Column1" = Table.ExpandRecordColumn(#"Converted to Table", "Column1", {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}, {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Expanded Column1",{{"NamTit", type text}, {"Views", Int64.Type}, {"guests", Int64.Type}, {"timestamp", type any}, {"poster", type text}, {"scrap_time", type datetime}})
		in
		    #"Changed Type"
	lineageTag: ba55b974-ed9c-4203-a9f8-31d3b00e7932
	queryGroup: 'Transform File from Query6'

	annotation PBI_ResultType = Table

expression 'Transform File' =
		let
		    Source = (Parameter1 as binary) => let
		    Source = Json.Document(Parameter1),
		    #"Converted to Table" = Table.FromList(Source, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
		    #"Expanded Column1" = Table.ExpandRecordColumn(#"Converted to Table", "Column1", {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}, {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Expanded Column1",{{"NamTit", type text}, {"Views", Int64.Type}, {"guests", Int64.Type}, {"timestamp", type any}, {"poster", type text}, {"scrap_time", type datetime}})
		in
		    #"Changed Type"
		in
		    Source
	mAttributes: [ FunctionQueryBinding = "{""exemplarFormulaName"":""Transform Sample File""}" ]
	lineageTag: 559294f4-527a-4df7-b808-fe9ddd61f502
	queryGroup: 'Transform File from Query6\Helper Queries'

	annotation PBI_ResultType = Function

expression 'Sample File (2)' =
		let
		    // Connect directly to the container
		    Source = AzureStorage.DataLake("https://lstor.dfs.core.windows.net/naircont"),
		
		    // Keep only JSON files
		    JSONFiles = Table.SelectRows(Source, each Text.EndsWith(Text.Lower([Name]), ".json")),
		
		    // Decode the folder path (replace %3D with =, %2F with /)
		    AddDecodedPath = Table.AddColumn(
		        JSONFiles,
		        "DecodedPath",
		        each Text.Replace(Text.Replace([Folder Path], "%3D", "="), "%2F", "/")
		    ),
		
		    // Parse date and hour from the decoded path
		    AddParsedDateTime = Table.AddColumn(
		        AddDecodedPath,
		        "DateTimeKey",
		        each
		            let
		                Path = Text.Lower([DecodedPath]),
		                Year = try Number.FromText(Text.BetweenDelimiters(Path, "year=", "/")) otherwise null,
		                Month = try Number.FromText(Text.BetweenDelimiters(Path, "month=", "/")) otherwise null,
		                Day = try Number.FromText(Text.BetweenDelimiters(Path, "day=", "/")) otherwise null,
		                Hour = try Number.FromText(Text.BetweenDelimiters(Path, "hour=", "/")) otherwise 0,
		                DT = try #datetime(Year, Month, Day, Hour, 0, 0) otherwise null
		            in
		                DT
		    ),
		
		    // Keep valid date/hour files only
		    ValidFiles = Table.SelectRows(AddParsedDateTime, each [DateTimeKey] <> null),
		
		    // Get most recent JSON file
		    LatestDateTime = if Table.IsEmpty(ValidFiles) then null else List.Max(ValidFiles[DateTimeKey]),
		    LatestFile = if LatestDateTime <> null then Table.SelectRows(ValidFiles, each [DateTimeKey] = LatestDateTime) else #table({}, {}),
		    #"Expanded Attributes" = Table.ExpandRecordColumn(LatestFile, "Attributes", {"Content Type", "Kind", "Size", "Group", "Owner", "Permissions"}, {"Attributes.Content Type", "Attributes.Kind", "Attributes.Size", "Attributes.Group", "Attributes.Owner", "Attributes.Permissions"}),
		    Navigation1 = #"Expanded Attributes"{0}[Content]
		in
		    Navigation1
	lineageTag: 81c38784-be6f-4eeb-9317-5c4355055b16
	queryGroup: 'Transform File from Query2\Helper Queries'

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Binary

expression Parameter2 = #"Sample File (2)" meta [IsParameterQuery=true, BinaryIdentifier=#"Sample File (2)", Type="Binary", IsParameterQueryRequired=true]
	lineageTag: a8c74fd6-ed26-4134-8b9c-863b6e0bcb7e
	queryGroup: 'Transform File from Query2\Helper Queries'

	annotation PBI_ResultType = Binary

expression 'Transform Sample File (2)' =
		let
		    Source = Json.Document(Parameter2),
		    #"Converted to Table" = Table.FromList(Source, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
		    #"Expanded Column1" = Table.ExpandRecordColumn(#"Converted to Table", "Column1", {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}, {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Expanded Column1",{{"NamTit", type text}, {"Views", Int64.Type}, {"guests", Int64.Type}, {"timestamp", type any}, {"poster", type text}, {"scrap_time", type datetime}})
		in
		    #"Changed Type"
	lineageTag: e7b425a1-0bb6-4868-a5e1-ce68eb7fbee0
	queryGroup: 'Transform File from Query2'

	annotation PBI_ResultType = Table

expression 'Transform File (2)' =
		let
		    Source = (Parameter2) => let
		        Source = Json.Document(Parameter2),
		        #"Converted to Table" = Table.FromList(Source, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
		        #"Expanded Column1" = Table.ExpandRecordColumn(#"Converted to Table", "Column1", {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}, {"NamTit", "Views", "guests", "timestamp", "poster", "scrap_time"}),
		        #"Changed Type" = Table.TransformColumnTypes(#"Expanded Column1",{{"NamTit", type text}, {"Views", Int64.Type}, {"guests", Int64.Type}, {"timestamp", type any}, {"poster", type text}, {"scrap_time", type datetime}})
		    in
		        #"Changed Type"
		in
		    Source
	mAttributes: [ FunctionQueryBinding = "{""exemplarFormulaName"":""Transform Sample File (2)""}" ]
	lineageTag: e2e1aa8c-3755-4b89-aff2-b5d0e4251c8e
	queryGroup: 'Transform File from Query2\Helper Queries'

	annotation PBI_ResultType = Function

